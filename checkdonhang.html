<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Check ƒê∆°n H√†ng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    html, body {
      height: 100%;
      overflow: hidden;
    }

    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #e5e7eb;
      border-radius: 10px;
    }
  </style>
</head>

<body class="h-full bg-gray-100">

<div class="flex flex-col h-full">

  <!-- HEADER -->
  <div class="bg-white border-b px-6 py-4 flex items-center justify-between">
    <h1 class="text-xl font-bold text-gray-800 flex items-center gap-2">
      <i class="fa-solid fa-magnifying-glass text-indigo-600"></i>
      Tra C·ª©u ƒê∆°n H√†ng / B·∫£o H√†nh
    </h1>
  </div>

  <!-- SEARCH BAR -->
  <div class="bg-gray-50 border-b px-6 py-4">
    <div class="relative max-w-2xl">
      <input
        id="keyword"
        type="text"
        placeholder="Nh·∫≠p SƒêT, IMEI / Seri, T√™n m√°y..."
        class="w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl
               focus:ring-2 focus:ring-indigo-500 outline-none font-medium"
        onkeypress="if(event.key==='Enter') searchOrder()"
      >
      <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
      <button
        onclick="searchOrder()"
        class="absolute right-2 top-1/2 -translate-y-1/2
               bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
        <i class="fa-solid fa-arrow-right"></i>
      </button>
    </div>
    <p class="text-xs text-gray-500 mt-2 italic">
      üí° M·∫πo: nh·∫≠p 4‚Äì5 s·ªë cu·ªëi SƒêT ƒë·ªÉ t√¨m nhanh
    </p>
  </div>

  <!-- CONTENT -->
  <div class="flex-1 overflow-y-auto custom-scrollbar relative bg-white">

    <!-- LOADING -->
    <div id="loading"
         class="hidden absolute inset-0 bg-white/90 z-10
                flex flex-col items-center justify-center">
      <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600 mb-2"></div>
      <span class="text-indigo-600 font-bold text-sm">ƒêang t√¨m ki·∫øm...</span>
    </div>

    <!-- RESULTS -->
    <div id="results" class="divide-y divide-gray-100">
      <div class="text-center text-gray-400 py-16">
        <i class="fa-solid fa-clipboard-list text-5xl mb-4 text-gray-300"></i>
        <p class="text-sm">Nh·∫≠p th√¥ng tin ƒë·ªÉ tra c·ª©u l·ªãch s·ª≠ mua h√†ng</p>
      </div>
    </div>

  </div>

</div>

<script>
/* ================= CONFIG ================= */
const API_URL =
  'https://script.google.com/macros/s/AKfycbxVvMU_8lHs-PaOPw3mbOhxA2ih4ng90h7d5aKatwlgTUHgOIyjKjw44yKaLJemAGK-/exec';

/* ================= SEARCH ================= */
async function searchOrder() {
  const k = document.getElementById('keyword').value.trim();
  if (!k) return;

  const loading = document.getElementById('loading');
  const results = document.getElementById('results');

  loading.classList.remove('hidden');
  results.innerHTML = '';

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify({
        action: 'search_orders',
        keyword: k
      })
    });

    const json = await res.json();
    loading.classList.add('hidden');

    if (json.success && json.data.length > 0) {
      json.data.forEach(item => {
        const price = Number(item.GIA).toLocaleString('vi-VN') + ' ‚Ç´';

        const div = document.createElement('div');
        div.className = 'p-5 hover:bg-indigo-50 transition';

        div.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div class="font-bold text-indigo-700 text-lg">${item.NAME}</div>
            <div class="text-xs font-mono bg-gray-200 px-2 py-1 rounded">
              ${item.DATE}
            </div>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm mt-2">
            <div>
              <div class="text-gray-400 text-xs font-bold">IMEI</div>
              <div class="font-mono font-bold">${item.SERI}</div>
            </div>
            <div>
              <div class="text-gray-400 text-xs font-bold">KH√ÅCH</div>
              <div class="font-bold">${item.KHACH}</div>
            </div>
            <div>
              <div class="text-gray-400 text-xs font-bold">GI√Å B√ÅN</div>
              <div class="font-bold text-red-600">${price}</div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3 mt-3 text-xs border rounded-lg p-3 bg-gray-50">
            <div>
              <div class="text-gray-400 font-bold">Bao Test</div>
              <div class="font-bold text-indigo-600">${item.BAOTEST || '-'}</div>
            </div>
            <div>
              <div class="text-gray-400 font-bold">B·∫£o H√†nh</div>
              <div class="font-bold text-indigo-600">${item.BAOHANH || '-'}</div>
            </div>
            <div>
              <div class="text-gray-400 font-bold">Sale</div>
              <div class="font-bold">${item.SALE || '-'}</div>
            </div>
            <div>
              <div class="text-gray-400 font-bold">Thanh To√°n</div>
              <div class="font-bold">${item.PTTT || '-'}</div>
            </div>
          </div>

          ${item.GHICHU ? `
            <div class="mt-3 text-xs italic text-gray-600 bg-yellow-50 p-2 rounded">
              <i class="fa-regular fa-note-sticky mr-1"></i>${item.GHICHU}
            </div>` : ''}
        `;

        results.appendChild(div);
      });
    } else {
      results.innerHTML = `
        <div class="text-center py-16 text-gray-400 italic">
          Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng v·ªõi "<b>${k}</b>"
        </div>`;
    }

  } catch (err) {
    loading.classList.add('hidden');
    results.innerHTML = `
      <div class="text-center py-16 text-red-500 font-bold">
        ‚ö†Ô∏è L·ªói k·∫øt n·ªëi API
      </div>`;
  }
}
</script>

</body>
</html>
